<!DOCTYPE html>

<html>
<head>
  <title>
  Tree Drawer Tester
  </title>
  <link rel="stylesheet" type="text/css" href="index.css" />
</head>

<body>
  
  <div id="actions-container">
    <button type="button" id="json-text-button" onclick="loadStringData()">Draw Tree with JSON In Text Box</button>
    <button type="button" id="json-url-button" onclick="loadRemoteData()">Draw Tree With JSON From URL</button>
    <button type="button" id="json-default-button" onclick="loadDefaultData()">Draw Tree With Default Plugin Data</button>
  </div>

  <div class="output">
    <h2>Tree Output</h2>
    <div id="tree-container"></div>
  </div>

  <div id="options-container" class="container-column">
    <h2>Tree Options</h2>
    <table>
      <tr>
        <td><label for="option-tree-container-id">Tree Container ID (Disabled)</label></td>
        <td><input type="text" id="option-tree-container-id" /></td>
      </tr>
      <tr>
        <td><label for="option-child-node-name">Child Node JSON Name</label></td>
        <td><input type="text" id="option-child-node-name" /></td>
      </tr>
      <tr>
        <td><label for="tree-orientation">Tree Orientation</label></td>
        <td class="options-module">
            <input type="radio" name="tree-orientation" id="tree-orientation-0" value="0" />
            <label for="tree-orientation-0">0 Degrees</label><br>
            <input type="radio" name="tree-orientation" id="tree-orientation-90" value="90" />
            <label for="tree-orientation-90">90 Degrees</label><br>
            <input type="radio" name="tree-orientation" id="tree-orientation-180" value="180" />
            <label for="tree-orientation-180">180 Degrees</label><br>
            <input type="radio" name="tree-orientation" id="tree-orientation-270" value="270" />
            <label for="tree-orientation-270">270 Degrees</label><br>
        </td>
      </tr>
      <tr>
        <td><label for="link-orientation">Link Orientation</label></td>
        <td class="options-module">
            <input type="radio" name="link-orientation" id="link-orientation-down" value="down" />
            <label for="link-orientation-down">180 Degrees</label><br>
            <input type="radio" name="link-orientation" id="link-orientation-up" value="up" />
            <label for="link-orientation-up">270 Degrees</label><br>
        </td>
      </tr>
      <tr>
        <td><label for="option-link-strategy">Link Strategy</label></td>
        <td class="options-module">
            <input type="radio" name="option-link-strategy" id="option-link-strategy-elbow" value="elbow" />
            <label for="option-link-strategy-elbow">Elbow Links</label><br>
            <input type="radio" name="option-link-strategy" id="option-link-strategy-diag" value="diagonal" />
            <label for="option-link-strategy-diag">Curved Links</label><br>
        </td>
      </tr>
      <tr>
        <td><label for="option-node-width">Node Width (px)</label></td>
        <td><input type="text" id="option-node-width" /></td>
      </tr>
      <tr>
        <td><label for="option-node-width">Node Height (px)</label></td>
        <td><input type="text" id="option-node-height" /></td>
      </tr>
      <tr>
        <td><label for="option-node-depth-spacing">Node Depth Spacing (px)</label></td>
        <td><input type="text" id="option-node-depth-spacing" /></td>
      </tr>
      <tr>
        <td><label for="option-node-sibling-spacing">Node Sibling Spacing (px)</label></td>
        <td><input type="text" id="option-node-sibling-spacing" /></td>
      </tr>
      <tr>
        <td><label for="option-node-background-classes">Node Background Classes</label></td>
        <td><input type="text" id="option-node-background-classes" /></td>
      </tr>
      <tr>
        <td><label for="option-node-html-classes">Node HTML Template Classes</label></td>
        <td><input type="text" id="option-node-html-classes" /></td>
      </tr>
      <tr>
        <td><label for="option-link-body-classes">Link Body Classes</label></td>
        <td><input type="text" id="option-link-body-classes" /></td>
      </tr>
      <tr>
        <td><label for="option-link-arrow-classes">Link Arrow Classes</label></td>
        <td><input type="text" id="option-link-arrow-classes" /></td>
      </tr>
      <tr>
        <td><label for="option-forobj-not-supported">Foreign Obj Not Supported Msg</label></td>
        <td><input type="text" id="option-forobj-not-supported" /></td>
      </tr>
    </table>
  </div>

  <div id="data-container" class="container-column">

    <h2>JSON Tree Data
      <p>Paste either stringified JSON Tree data or a URL that links to your JSON</p>
    </h2>
    <textarea id="json-input"></textarea>

    <h2>Node HTML Template
      <p>Add the HTML template to be used for each node</p>
    </h2>
    <textarea id="html-template-input"></textarea>

  </div>

  <div class="output">

    <h2>JSON Output</h2>
    <div id="json-container"></div>

    <h2>Compiled User Options
      <p>This json string can be copied and passed into the function call to reproduce the observed tree</p>
    </h2>
    <div id="compiled-options"></div>

  </div>

</body>

<script type="text/javascript" src="http://code.jquery.com/jquery-1.11.1.js"></script>
<script type="text/javascript" src="http://d3js.org/d3.v3.js" charset="utf-8"></script>
<script type="text/javascript" src="http://underscorejs.org/underscore.js"></script>
<script type="text/javascript" src="treedrawerplugin.js"></script>

<script type="text/javascript">

  var loadStringData = function() {
    var userInput = buildOptions();

    $('#tree-container').text('');
    $('#compiled-options').text(JSON.stringify(userInput));
    
    $('#tree-container').html('');
    $('#tree-container').drawTree(userInput);
  };

  var loadRemoteData = function(url) {
    alert('not implemented yet!');
  };

  var loadDefaultData = function() {
    $('#tree-container').html('');
    $('#tree-container').text('');
    $('#compiled-options').text(JSON.stringify({}));
    $('#tree-container').drawTree({});
  };

  var buildOptions = function() {
    var builtOptions = {};
    
    if ($("#option-tree-container-id").val() !== "") builtOptions.childNodeName = $("#option-tree-container-id").val();
    if ($("#option-child-node-name").val() !== "") builtOptions.childNodeName = $("#option-child-node-name").val();
   
    if ($("input:radio[name='tree-orientation']:checked").val()) builtOptions.treeOrientation = parseInt($("input:radio[name='tree-orientation']:checked").val());
    if ($("input:radio[name='link-orientation']:checked").val()) builtOptions.linkOrientation = parseInt($("input:radio[name='link-orientation']:checked").val());
    if ($("input:radio[name='option-link-strategy']:checked").val()) builtOptions.linkStrategy = $("input:radio[name='option-link-strategy']:checked").val();
    
    if ($("#option-node-width").val() !== "") {
      if(!builtOptions.nodeSizing) {
        builtOptions.nodeSizing = {};
      }
      builtOptions.nodeSizing.width = parseInt($("#option-node-width").val());
    }
    if ( $("#option-node-height").val() !== "" ) {
      if ( !builtOptions.nodeSizing ) {
        builtOptions.nodeSizing = {};
      }
      builtOptions.nodeSizing.height = parseInt($("#option-node-height").val());
    }
    if ( $("#option-node-depth-spacing").val() !== "" ) {
      if ( !builtOptions.nodeSpacing ) {
        builtOptions.nodeSpacing = {};
      }
      builtOptions.nodeSpacing.level = parseInt($("#option-node-depth-spacing").val());
    }
    if ( $("#option-node-sibling-spacing").val() !== "" ) {
      if( !builtOptions.nodeSpacing ) {
        builtOptions.nodeSpacing = {};
      }
      builtOptions.nodeSpacing.span = parseInt($("#option-node-sibling-spacing").val());
    }
    
    if ($("#option-node-background-classes").val() !== "") builtOptions.nodeBkndClasses = $("#option-node-background-classes").val().split(", ");
    if ($("#option-node-html-classes").val() !== "") builtOptions.nodeHTMLClasses = $("#option-node-html-classes").val().split(", ");
    if ($("#option-link-body-classes").val() !== "") builtOptions.linkClasses = $("#option-link-body-classes").val().split(", ");
    if ($("#option-link-arrow-classes").val() !== "") builtOptions.arrowClasses = $("#option-link-arrow-classes").val().split(", ");;
    if ($("#option-forobj-not-supported").val() !== "") builtOptions.notSupportedMessage = $("#option-forobj-not-supported").val();
    if ($("#html-template-input").val() !== "") builtOptions.nodeHTMLTemplate = $("#html-template-input").val();
    if ($("#json-input").val() !== "") builtOptions.node = $("#json-input").val();

    return builtOptions;
  };

</script>
</html>
