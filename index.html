<!DOCTYPE html>

<html>
<head>
  <title>
  Tree Drawer Tester
  </title>
  <link rel="stylesheet" type="text/css" href="index.css" />
</head>

<body>
  
  <div id="actions-container">
    <button type="button" class="action-button" id="json-text-button" onclick="loadStringData()">Draw Tree with JSON In Text Box</button>
    <button type="button" class="action-button" id="json-url-button" onclick="loadRemoteData()">Draw Tree With JSON From URL</button>
    <button type="button" class="action-button" id="json-default-button" onclick="loadDefaultData()">Draw Tree With Default Plugin Data</button>
  </div>

  <div class="output-container">
    <h2>Tree Output</h2>
    <div id="tree-container"></div>
  </div>

  <div id="options-container" class="container-column">
    <h2>Tree Options</h2>
    <table>
      <tr>
        <td><label for="option-tree-container-id">Tree Container ID (Disabled)</label></td>
        <td><input type="text" id="option-tree-container-id" /></td>
      </tr>
      <tr>
        <td><label for="option-child-node-name">Child Node JSON Name</label></td>
        <td><input type="text" id="option-child-node-name" /></td>
      </tr>
      <tr>
        <td><label for="tree-orientation">Tree Orientation</label></td>
        <td class="options-module">
            <input type="radio" name="tree-orientation" id="tree-orientation-0" value="0" />
            <label for="tree-orientation-0">0 Degrees</label><br>
            <input type="radio" name="tree-orientation" id="tree-orientation-90" value="90" />
            <label for="tree-orientation-90">90 Degrees</label><br>
            <input type="radio" name="tree-orientation" id="tree-orientation-180" value="180" />
            <label for="tree-orientation-180">180 Degrees</label><br>
            <input type="radio" name="tree-orientation" id="tree-orientation-270" value="270" />
            <label for="tree-orientation-270">270 Degrees</label><br>
        </td>
      </tr>
      <tr>
        <td><label for="link-orientation">Link Orientation</label></td>
        <td class="options-module">
            <input type="radio" name="link-orientation" id="link-orientation-down" value="down" />
            <label for="link-orientation-down">180 Degrees</label><br>
            <input type="radio" name="link-orientation" id="link-orientation-up" value="up" />
            <label for="link-orientation-up">270 Degrees</label><br>
        </td>
      </tr>
      <tr>
        <td><label for="option-link-strategy">Link Strategy</label></td>
        <td class="options-module">
            <input type="radio" name="option-link-strategy" id="option-link-strategy-elbow" value="elbow" />
            <label for="option-link-strategy-elbow">Elbow Links</label><br>
            <input type="radio" name="option-link-strategy" id="option-link-strategy-diag" value="diagonal" />
            <label for="option-link-strategy-diag">Curved Links</label><br>
        </td>
      </tr>
      <tr>
        <td><label for="option-node-width">Node Width (px)</label></td>
        <td><input type="text" id="option-node-width" /></td>
      </tr>
      <tr>
        <td><label for="option-node-width">Node Height (px)</label></td>
        <td><input type="text" id="option-node-height" /></td>
      </tr>
      <tr>
        <td><label for="option-node-depth-spacing">Node Depth Spacing (px)</label></td>
        <td><input type="text" id="option-node-depth-spacing" /></td>
      </tr>
      <tr>
        <td><label for="option-node-sibling-spacing">Node Sibling Spacing (px)</label></td>
        <td><input type="text" id="option-node-sibling-spacing" /></td>
      </tr>
      <tr>
        <td class="option-label-column">
          <label for="option-node-background-classes">Node Background Classes</label><br>
          <span class="add-row-button disableDblClick" data-listid="#option-node-background-classes">Add Class Row</span>
        </td>
        <td class="option-input-column">
          <ul id="option-node-background-classes" class="option-list">
            <li class="option-list-item">
              <input type="text" id="option-node-background-item-0" class="option-list-item-input" />
            </li>
          </ul>
        </td>
      </tr>
      <tr>
        <td class="option-label-column">
          <label for="option-node-html-classes">Node HTML Template Classes</label><br>
          <span class="add-row-button disableDblClick" data-listid="#option-node-html-classes">Add Class Row</span>
        </td>
        <td class="option-input-column">
          <ul id="option-node-html-classes" class="option-list">
            <li class="option-list-item">
              <input type="text" id="option-node-html-item-0" class="option-list-item-input" />
            </li>
          </ul>
        </td>
      </tr>
      <tr>
        <td class="option-label-column">
          <label for="option-link-body-classes">Link Body Classes</label><br>
          <span class="add-row-button disableDblClick" data-listid="#option-link-body-classes">Add Class Row</span>
        </td>
        <td class="option-input-column">
          <ul id="option-link-body-classes" class="option-list">
            <li class="option-list-item">
              <input type="text" id="option-link-body-item-0" class="option-list-item-input" />
            </li>
          </ul>
        </td>
      </tr>
      <tr>
        <td class="option-label-column">
          <label for="option-link-arrow-classes">Link Arrow Classes</label><br>
          <span class="add-row-button disableDblClick" data-listid="#option-link-arrow-classes">Add Class Row</span>
        </td>
        <td class="option-input-column">
          <ul id="option-link-arrow-classes" class="option-list">
            <li class="option-list-item">
              <input type="text" id="option-link-arrow-item-0" class="option-list-item-input" />
            </li>
          </ul>
        </td>
      </tr>
      <tr>
        <td><label for="option-forobj-not-supported">Foreign Obj Not Supported Msg</label></td>
        <td><input type="text" id="option-forobj-not-supported" /></td>
      </tr>
    </table>
  </div>

  <div id="data-container" class="container-column">

    <h2>JSON Tree Data Input
      <p>Paste either stringified JSON Tree data or a URL that links to your JSON</p>
    </h2>
    <textarea id="json-input"></textarea>

    <h2>Node-Body HTML Template
      <p>Add the HTML template to be used for each node</p>
    </h2>
    <textarea id="html-template-input"></textarea>

  </div>

  <div class="output-container">

    <h2>JSON User Options (Unformtatted String)
      <p>This json string can be copied and passed into the function call as user options to reproduce the manually configured tree.</p>
    </h2>
    <code>
        <div id="compiled-options"></div>
      </code>

    <h2>JSON User Options (Formatted Object)
      <p>This json string contains the above user-specified options, formatted for human readability.</p>
    </h2>
    <pre>
      <code id="json-formatted-options">
      </code>
    </pre>

  </div>

</body>

<script type="text/javascript" src="http://code.jquery.com/jquery-1.11.1.js"></script>
<script type="text/javascript" src="http://d3js.org/d3.v3.js" charset="utf-8"></script>
<script type="text/javascript" src="http://underscorejs.org/underscore.js"></script>
<script type="text/javascript" src="treedrawerplugin.js"></script>

<script type="text/javascript">


  var loadStringData = function() {
    var userInput = buildOptions();

    $('#tree-container').text('');
    $('#compiled-options').text(JSON.stringify(userInput));
    $('#json-formatted-options').text(JSON.stringify(userInput, undefined, 2));
    
    $('#tree-container').html('');
    $('#tree-container').drawTree(userInput);
  };

  var loadRemoteData = function(url) {
    alert('not implemented yet!');
  };

  var loadDefaultData = function() {

    $('#compiled-options').text(JSON.stringify({}));

    $('#tree-container').html('');
    $('#tree-container').drawTree({});
  };

  $(".add-row-button").click(function(e) {
    var self = this;
    var ul = $(self.dataset.listid);

    var li = document.createElement("li");
    li.className = "option-list-item";

    var input = document.createElement("input");
    input.type = "text";
    input.className = "option-list-item-input";

    li.appendChild(input);
    ul.append(li);
  });

  $('.disableDblClick').bind('dblclick',function(e){
    e.preventDefault();
  });

  var buildClassArray = function(listId) {
    var listItemsEl = document.getElementById(listId).getElementsByTagName('li');
    var outputList = [];
    for(var i = 0; i < listItemsEl.length; i++) {
      var listItemEl = listItemsEl[i];
      var itemInputEl = listItemEl.getElementsByTagName('input')[0];
      var listItemValue = itemInputEl.value;

      if(listItemValue !== "") {
        outputList.push(listItemValue);
      }

    }
    return outputList;
  }

  var buildOptions = function() {
    var builtOptions = {};
    
    if ($("#option-tree-container-id").val() !== "") builtOptions.childNodeName = $("#option-tree-container-id").val();
    if ($("#option-child-node-name").val() !== "") builtOptions.childNodeName = $("#option-child-node-name").val();
   
    if ($("input:radio[name='tree-orientation']:checked").val()) builtOptions.treeOrientation = parseInt($("input:radio[name='tree-orientation']:checked").val());
    if ($("input:radio[name='link-orientation']:checked").val()) builtOptions.linkOrientation = parseInt($("input:radio[name='link-orientation']:checked").val());
    if ($("input:radio[name='option-link-strategy']:checked").val()) builtOptions.linkStrategy = $("input:radio[name='option-link-strategy']:checked").val();
    
    if ($("#option-node-width").val() !== "") {
      if(!builtOptions.nodeSizing) {
        builtOptions.nodeSizing = {};
      }
      builtOptions.nodeSizing.width = parseInt($("#option-node-width").val());
    }
    if ( $("#option-node-height").val() !== "" ) {
      if ( !builtOptions.nodeSizing ) {
        builtOptions.nodeSizing = {};
      }
      builtOptions.nodeSizing.height = parseInt($("#option-node-height").val());
    }
    if ( $("#option-node-depth-spacing").val() !== "" ) {
      if ( !builtOptions.nodeSpacing ) {
        builtOptions.nodeSpacing = {};
      }
      builtOptions.nodeSpacing.level = parseInt($("#option-node-depth-spacing").val());
    }
    if ( $("#option-node-sibling-spacing").val() !== "" ) {
      if( !builtOptions.nodeSpacing ) {
        builtOptions.nodeSpacing = {};
      }
      builtOptions.nodeSpacing.span = parseInt($("#option-node-sibling-spacing").val());
    }

    builtOptions.nodeBkndClasses = buildClassArray("option-node-background-classes");
    builtOptions.nodeHTMLClasses = buildClassArray("option-node-html-classes");
    builtOptions.linkClasses = buildClassArray("option-link-body-classes");
    builtOptions.arrowClasses = buildClassArray("option-link-arrow-classes");
    if (builtOptions.nodeBkndClasses.length === 0) { delete builtOptions.nodeBkndClasses; }
    if (builtOptions.nodeHTMLClasses.length === 0) { delete builtOptions.nodeHTMLClasses; }
    if (builtOptions.linkClasses.length === 0) { delete builtOptions.linkClasses; }
    if (builtOptions.arrowClasses.length === 0) { delete builtOptions.arrowClasses; }

    if ($("#option-forobj-not-supported").val() !== "") builtOptions.notSupportedMessage = $("#option-forobj-not-supported").val();
    if ($("#html-template-input").val() !== "") builtOptions.nodeHTMLTemplate = $("#html-template-input").val();
    if ($("#json-input").val() !== "") builtOptions.node = $("#json-input").val();

    return builtOptions;
  };

</script>
</html>
