<!DOCTYPE html>

<html>
<head>
  <title>
  Tree Drawer Tester
  </title>

  <!-- Latest compiled and minified CSS -->
  <link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css" />
  <link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap-theme.min.css" />
  <link rel="stylesheet" type="text/css" href="index.css" />
</head>

<body>
  <nav class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">
      <ul class="nav nav-justified navbar-nav">
        <li class="">
          <a href="javascript:void(0)" id="draw-tree-button" onclick="drawTreeOnPage()">Draw Tree</a>
        </li>
        <li class="">
          <a href="javascript:void(0)" id="json-text-button" onclick="drawSettings()">Refresh Settings Displayed</a>
        </li>
      </ul>
    <div>
  </nav>
  <div role="main" class="main-container">
    <h1 class="col-md-12 col-sm-12 col-xs-12">Tree Drawer Demo Site</h1>
  
      <div class="col-md-6">
        <h2>Choose Settings Source</h2>
        <div class="options-module">
          <input type="radio" name="settings-source" id="settings-source-0" value="default" checked />
          <label for="settings-source-0">Default Settings</label><br>
          <input type="radio" name="settings-source" id="settings-source-1" value="user" />
          <label for="settings-source-1">User Selected Settings</label>
        </div>
      </div>
      <div class="col-md-6">
        <h2>Choose Data Source</h2>
        <div class="options-module">
          <input type="radio" name="data-source" id="data-source-0" value="default" checked />
          <label for="data-source-0">Default Data</label><br>
          <input type="radio" name="data-source" id="data-source-1" value="user" />
          <label for="data-source-1">User Input Data</label>
        </div>
      </div>
  
      <div class="col-md-12 col-sm-12 col-xs-12">
        <h2>Tree Output</h2>
        <div id="tree-container"></div>
      </div>
  
    <div id="options-container" class="col-xs-12 col-sm-12 col-md-12">
      <h2>Tree Settings</h2>
      <table class="table">
        <tr>
          <td><label for="option-tree-container-id">Tree Container ID (Disabled)</label></td>
          <td><input type="text" id="option-tree-container-id" /></td>
        </tr>
        <tr>
          <td><label for="option-child-node-name">Child Node JSON Name</label></td>
          <td><input type="text" id="option-child-node-name" /></td>
        </tr>
        <tr>
          <td><label for="tree-orientation">Tree Orientation</label></td>
          <td class="options-module">
              <input type="radio" name="tree-orientation" id="tree-orientation-0" value="0" />
              <label for="tree-orientation-0">0 &#176</label><br>
              <input type="radio" name="tree-orientation" id="tree-orientation-90" value="90" />
              <label for="tree-orientation-90">90 &#176</label><br>
              <input type="radio" name="tree-orientation" id="tree-orientation-180" value="180" />
              <label for="tree-orientation-180">180 &#176</label><br>
              <input type="radio" name="tree-orientation" id="tree-orientation-270" value="270" />
              <label for="tree-orientation-270">270 &#176</label>
          </td>
        </tr>
        <tr>
          <td><label for="link-orientation">Link Orientation</label></td>
          <td class="options-module">
              <input type="radio" name="link-orientation" id="link-orientation-down" value="down" />
              <label for="link-orientation-down">Down Tree</label><br>
              <input type="radio" name="link-orientation" id="link-orientation-up" value="up" />
              <label for="link-orientation-up">Up Tree</label>
          </td>
        </tr>
        <tr>
          <td><label for="option-link-strategy">Link Strategy</label></td>
          <td class="options-module">
              <input type="radio" name="option-link-strategy" id="option-link-strategy-elbow" value="elbow" />
              <label for="option-link-strategy-elbow">Elbow Links</label><br>
              <input type="radio" name="option-link-strategy" id="option-link-strategy-diag" value="diagonal" />
              <label for="option-link-strategy-diag">Curved Links</label><br>
          </td>
        </tr>
        <tr>
          <td><label for="option-node-width">Node Width (px)</label></td>
          <td><input type="text" id="option-node-width" /></td>
        </tr>
        <tr>
          <td><label for="option-node-width">Node Height (px)</label></td>
          <td><input type="text" id="option-node-height" /></td>
        </tr>
        <tr>
          <td><label for="option-node-depth-spacing">Node Depth Spacing (px)</label></td>
          <td><input type="text" id="option-node-depth-spacing" /></td>
        </tr>
        <tr>
          <td><label for="option-node-sibling-spacing">Node Sibling Spacing (px)</label></td>
          <td><input type="text" id="option-node-sibling-spacing" /></td>
        </tr>
        <tr>
          <td class="option-label-column">
            <label for="option-node-background-classes">Node Background Classes</label><br>
            <span class="add-row-button disableDblClick" data-listid="#option-node-background-classes">Add Class Row</span>
          </td>
          <td class="option-input-column">
            <ul id="option-node-background-classes" class="option-list">
              <li class="option-list-item">
                <input type="text" id="option-node-background-item-0" class="option-list-item-input" />
              </li>
            </ul>
          </td>
        </tr>
        <tr>
          <td class="option-label-column">
            <label for="option-node-html-classes">Node HTML Template Classes</label><br>
            <span class="add-row-button disableDblClick" data-listid="#option-node-html-classes">Add Class Row</span>
          </td>
          <td class="option-input-column">
            <ul id="option-node-html-classes" class="option-list">
              <li class="option-list-item">
                <input type="text" id="option-node-html-item-0" class="option-list-item-input" />
              </li>
            </ul>
          </td>
        </tr>
        <tr>
          <td class="option-label-column">
            <label for="option-link-body-classes">Link Body Classes</label><br>
            <span class="add-row-button disableDblClick" data-listid="#option-link-body-classes">Add Class Row</span>
          </td>
          <td class="option-input-column">
            <ul id="option-link-body-classes" class="option-list">
              <li class="option-list-item">
                <input type="text" id="option-link-body-item-0" class="option-list-item-input" />
              </li>
            </ul>
          </td>
        </tr>
        <tr>
          <td class="option-label-column">
            <label for="option-link-arrow-classes">Link Arrow Classes</label><br>
            <span class="add-row-button disableDblClick" data-listid="#option-link-arrow-classes">Add Class Row</span>
          </td>
          <td class="option-input-column">
            <ul id="option-link-arrow-classes" class="option-list">
              <li class="option-list-item">
                <input type="text" id="option-link-arrow-item-0" class="option-list-item-input" />
              </li>
            </ul>
          </td>
        </tr>
        <tr>
          <td><label for="option-forobj-not-supported">Foreign Obj Not Supported Msg</label></td>
          <td><input type="text" id="option-forobj-not-supported" /></td>
        </tr>
      </table>
    </div>
  
    <div id="data-container" class="col-xs-12 col-sm-6 col-md-6 data-container">
      <h2>JSON Tree Data Input
        <p>Add either stringified JSON data or a URL that links to your JSON</p>
      </h2>
      <textarea class="textarea-input"></textarea>

    </div>
    <div class="col-xs-12 col-sm-6 col-md-6 data-container">
      <h2>Node HTML Template
        <p>Add the HTML template to be used for each node</p>
      </h2>
      <textarea class="textarea-input"></textarea>
  
    </div>
  
    <div class="col-xs-12 col-sm-6 col-md-6">
      <h2>JSON User Settings (Unformtatted String)
        <p>This json string can be copied and passed into the function call as user settings to reproduce the manually configured tree.</p>
      </h2>
      <pre>
        <code id="compiled-options" class="code-container">
        </code>
      </pre>
    </div>

    <div class="col-xs-12 col-sm-6 col-md-6">
      <h2>JSON User Settings (Formatted Object)
        <p>This json string contains the above user-specified settings, formatted for human readability.</p>
      </h2>
      <pre>
        <code id="json-formatted-options" class="code-container">
        </code>
      </pre>
  
    </div>
  </div>
</body>

<script type="text/javascript" src="http://code.jquery.com/jquery-1.11.1.js"></script>
<script type="text/javascript" src="http://d3js.org/d3.v3.js" charset="utf-8"></script>
<script type="text/javascript" src="http://underscorejs.org/underscore.js"></script>
<script type="text/javascript" src="treedrawerplugin.js"></script>

<script type="text/javascript">

  var buildSettings = function() {
    var userSettings;

    if($("input:radio[name='settings-source']:checked").val() === "default") {
      userSettings = buildDefaultSettings();
    } else {
      userSettings = buildUserSettings();
    }

    return userSettings;
  };

  var refreshSettingsEls = function(settings) {
    $('#compiled-options').text('');
    $('#json-formatted-options').text('');
    $('#compiled-options').text(JSON.stringify(settings));
    $('#json-formatted-options').text(JSON.stringify(settings, undefined, 2));
  };

  var drawSettings = function() {
    var settings = buildSettings();
    refreshSettingsEls(settings);

    return settings;
  };

  var drawTreeOnPage = function() {
    var userSettings;

    userSettings = drawSettings();

    if ($("input:radio[name='data-source']:checked").val() !== "default" && $("#json-input").val() !== "") {
      userSettings.node = $("#json-input").val();
    }

    $('#tree-container').text('');
    $('#tree-container').drawTree(userSettings);
  };

  // Add a click event to each addRow button
  //    - Adds a new element to the text input list
  //    - Each item in group included when compiling settings
  //    - When options are compiled, all empty boxes are ignored
  $(".add-row-button").click(function(e) {
    var self = this;
    var ul = $(self.dataset.listid);

    var li = document.createElement("li");
    li.className = "option-list-item";

    var input = document.createElement("input");
    input.type = "text";
    input.className = "option-list-item-input";

    li.appendChild(input);
    ul.append(li);
  });

  var buildClassArray = function(listId) {
    var listItemsEl = document.getElementById(listId).getElementsByTagName('li');
    var outputList = [];
    for(var i = 0; i < listItemsEl.length; i++) {
      var listItemEl = listItemsEl[i];
      var itemInputEl = listItemEl.getElementsByTagName('input')[0];
      var listItemValue = itemInputEl.value;

      if(listItemValue !== "") {
        outputList.push(listItemValue);
      }

    }
    return outputList;
  }

  var buildUserSettings = function() {
    var settings = {};
    
    if ($("#option-tree-container-id").val() !== "") settings.childNodeName = $("#option-tree-container-id").val();
    if ($("#option-child-node-name").val() !== "") settings.childNodeName = $("#option-child-node-name").val();
   
    if ($("input:radio[name='tree-orientation']:checked").val()) settings.treeOrientation = parseInt($("input:radio[name='tree-orientation']:checked").val());
    if ($("input:radio[name='link-orientation']:checked").val()) settings.linkOrientation = $("input:radio[name='link-orientation']:checked").val();
    if ($("input:radio[name='option-link-strategy']:checked").val()) settings.linkStrategy = $("input:radio[name='option-link-strategy']:checked").val();
    
    if ($("#option-node-width").val() !== "") {
      if(!settings.nodeSizing) {
        settings.nodeSizing = {};
      }
      settings.nodeSizing.width = parseInt($("#option-node-width").val());
    }
    if ( $("#option-node-height").val() !== "" ) {
      if ( !settings.nodeSizing ) {
        settings.nodeSizing = {};
      }
      settings.nodeSizing.height = parseInt($("#option-node-height").val());
    }
    if ( $("#option-node-depth-spacing").val() !== "" ) {
      if ( !settings.nodeSpacing ) {
        settings.nodeSpacing = {};
      }
      settings.nodeSpacing.level = parseInt($("#option-node-depth-spacing").val());
    }
    if ( $("#option-node-sibling-spacing").val() !== "" ) {
      if( !settings.nodeSpacing ) {
        settings.nodeSpacing = {};
      }
      settings.nodeSpacing.span = parseInt($("#option-node-sibling-spacing").val());
    }

    settings.nodeBkndClasses = buildClassArray("option-node-background-classes");
    settings.nodeHTMLClasses = buildClassArray("option-node-html-classes");
    settings.linkClasses = buildClassArray("option-link-body-classes");
    settings.arrowClasses = buildClassArray("option-link-arrow-classes");
    if (settings.nodeBkndClasses.length === 0) { delete settings.nodeBkndClasses; }
    if (settings.nodeHTMLClasses.length === 0) { delete settings.nodeHTMLClasses; }
    if (settings.linkClasses.length === 0) { delete settings.linkClasses; }
    if (settings.arrowClasses.length === 0) { delete settings.arrowClasses; }

    if ($("#option-forobj-not-supported").val() !== "") settings.notSupportedMessage = $("#option-forobj-not-supported").val();
    if ($("#html-template-input").val() !== "") settings.nodeHTMLTemplate = $("#html-template-input").val();

    return settings;
  };

  var buildDefaultSettings = function() {
    var defaultSettings = {
      treeContainerId: '#tree-container',
      treeOrientation: 0,
      linkOrientation: 'down',
      childNodeName: 'node',
      linkStrategy: 'elbow',
      nodeSizing: {
        width: 20,
        height: 20
      },
      nodeSpacing: {
        level: 20,
        span: 20
      },
      nodeBkndClasses: [],
      nodeHTMLClasses: [],
      linkClasses: [],
      arrowClasses: [],
      notSupportedMessage: 'Sorry, d3 html templates are not supported by your browser.',
      nodeHTMLTemplate: function (d) {
        return '<div id="node-template">' + d.dataValue + '</div>';
      }
    };

    defaultSettings.nodeBkndClasses.push('node-background');
    defaultSettings.nodeHTMLClasses.push('node-html-container');
    defaultSettings.linkClasses.push('link-html-container');
    defaultSettings.arrowClasses.push('arrow-html-container');

    return defaultSettings;
  };

</script>
</html>
