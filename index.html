<!DOCTYPE html>
<!-- Tree-drawing demo site, for configuring and testing customization settings -->

<html>
<head>
  <title>
  Tree-Drawing jQuery Plugin
  </title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <link rel="stylesheet" type="text/css" href="styles/lib/bootstrap-3.2.0.css" />
  <link rel="stylesheet" type="text/css" href="styles/lib/bootstrap-theme-3.2.0.css" />
  <link rel="stylesheet" type="text/css" href="styles/index.css" />
</head>

<body>

  <nav class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">
      <ul class="nav nav-justified navbar-nav">
        <li class="">
          <a href="javascript:void(0)" onclick="buildAndRefreshTree()">Draw Tree</a>
        </li>
      </ul>
    </div>
  </nav>

  <div role="main" class="main-container">
    <h1 class="col-xs-12 col-sm-12 col-md-12">Tree-Drawing jQuery Plugin Demo Site
        <div class="sub-title-link"><a id="source-code-link" target="_blank" href="https://github.com/cssetian/generic-tree-drawer">Source</a></div>
    </h1>
  
    <!-- Container for displaying drawn Tree -->
    <div class="col-xs-12 col-sm-12 col-md-12">
      <h3>Tree Output</h3>
      <span class="output-container" id="tree-container"></span>
    </div>
  
    <!-- Custom Inputs for Configuring Tree -->
    <div id="options-container" class="col-xs-12 col-sm-12 col-md-12">
      <h3>Tree Customization
        <div class="sub-title-button"><a id="toggle-settings-modules">Close / Open All Modules</a></div>
      </h3>
      <div class="panel panel-default">
        <div class="panel-heading" data-toggle="collapse" href="#tree-settings-collapse">
          <h4 class="panel-title">
            <a>
              Settings
            </a>
          </h4>
        </div>
        <div id="tree-settings-collapse" class="panel-collapse collapse in">
          <div class="panel-body settings-panel-body">

          <table class="table">
            <tr>
              <td><label for="settings-source">Settings Source</label></td>
              <td>
                <div class="options-module">
                  <div class="radio">
                    <label>
                      <input type="radio" name="settings-source" id="settings-source-0" value="default" checked>
                      Default Settings (Auto-Populated Below)
                    </label>
                  </div>
                  <div class="radio">
                    <label>
                      <input type="radio" name="settings-source" id="settings-source-1" value="user">
                      User Settings (Overrides Defaults)
                    </label>
                  </div>
                </div>
              </td>
            </tr>
            <tr>
              <td><label for="data-source">Data Source</label></td>
              <td>
                <div class="options-module">
                  <div class="radio">
                    <label>
                      <input type="radio" name="data-source" id="data-source-0" value="default" checked>
                      Default Data (Auto-Populated Below)
                    </label>
                  </div>
                  <div class="radio">
                    <label>
                      <input type="radio" name="data-source" id="data-source-1" value="user">
                      User Data (Overrides Defaults)
                    </label>
                  </div>
                </div>
              </td>
            </tr>
            <tr>
              <td><label for="option-tree-container-id">Tree Container ID (Disabled)</label></td>
              <td><input type="text" id="option-tree-container-id" placeholder="#tree-container" disabled="true" /></td>
            </tr>
            <tr>
              <td><label for="option-tree-container-padding">Tree Container Padding</label></td>
              <td><input type="text" id="option-tree-container-padding" /></td>
            </tr>
            <tr>
              <td><label for="option-node-child-name">JSON Tree Node Property Name</label></td>
              <td><input type="text" id="option-node-child-name" /></td>
            </tr>
            <tr>
              <td><label for="option-node-data-name">JSON Tree Data Property Name</label></td>
              <td><input type="text" id="option-node-data-name" /></td>
            </tr>
            <tr>
              <td><label for="tree-orientation">Tree Orientation</label></td>
              <td class="options-module">
                <div class="radio">
                  <label>
                    <input type="radio" name="tree-orientation" id="tree-orientation-down" value="down">
                    Down
                  </label>
                </div>
                <div class="radio">
                  <label>
                    <input type="radio" name="tree-orientation" id="tree-orientation-left" value="left">
                    Left
                  </label>
                </div>
                <div class="radio">
                  <label>
                    <input type="radio" name="tree-orientation" id="tree-orientation-up" value="up">
                    Up
                  </label>
                </div>
                <div class="radio">
                  <label>
                    <input type="radio" name="tree-orientation" id="tree-orientation-right" value="right">
                    Right
                  </label>
                </div>
              </td>
            </tr>
            <tr>
              <td><label for="link-orientation">Link Orientation</label></td>
              <td class="options-module">
                <div class="radio">
                  <label>
                    <input type="radio" name="link-orientation" id="link-orientation-down" value="down">
                    Down Tree
                  </label>
                </div>
                <div class="radio">
                  <label>
                    <input type="radio" name="link-orientation" id="link-orientation-up" value="up">
                    Up Tree
                  </label>
                </div>
              </td>
            </tr>
            <tr>
              <td><label for="option-link-strategy">Link Strategy</label></td>
              <td class="options-module">
                <div class="radio">
                  <label>
                    <input type="radio" name="option-link-strategy" id="option-link-strategy-elbow" value="elbow">
                    Elbow Links
                  </label>
                </div>
                <div class="radio">
                  <label>
                    <input type="radio" name="option-link-strategy" id="option-link-strategy-diag" value="diagonal">
                    Curved Links
                  </label>
                </div>
              </td>
            </tr>
            <tr>
              <td><label for="option-node-width">Node Width (px)</label></td>
              <td><input type="text" id="option-node-width" /></td>
            </tr>
            <tr>
              <td><label for="option-node-width">Node Height (px)</label></td>
              <td><input type="text" id="option-node-height" /></td>
            </tr>
            <tr>
              <td><label for="option-node-depth-spacing">Node Depth Spacing (px)</label></td>
              <td><input type="text" id="option-node-depth-spacing" /></td>
            </tr>
            <tr>
              <td><label for="option-node-width-spacing">Node Sibling Spacing (px)</label></td>
              <td><input type="text" id="option-node-width-spacing" /></td>
            </tr>
            <tr>
              <td class="option-label-column align-top">
                <label for="option-node-background-classes">Node Background Classes</label><br>
                <span class="sub-title-button add-row disableDblClick" data-listid="#option-node-background-classes">Add Class Row</span>
              </td>
              <td class="option-input-column">
                <ul id="option-node-background-classes" class="option-list">
                  <li class="option-list-item">
                    <input type="text" id="option-node-background-item-0" class="option-list-item-input" />
                  </li>
                </ul>
              </td>
            </tr>
            <tr>
              <td class="option-label-column align-top">
                <label for="option-node-html-classes">Node HTML Template Classes</label><br>
                <span class="sub-title-button add-row disableDblClick" data-listid="#option-node-html-classes">Add Class Row</span>
              </td>
              <td class="option-input-column">
                <ul id="option-node-html-classes" class="option-list">
                  <li class="option-list-item">
                    <input type="text" id="option-node-html-item-0" class="option-list-item-input" />
                  </li>
                </ul>
              </td>
            </tr>
            <tr>
              <td class="option-label-column align-top">
                <label for="option-link-body-classes">Link Body Classes</label><br>
                <span class="sub-title-button add-row disableDblClick" data-listid="#option-link-body-classes">Add Class Row</span>
              </td>
              <td class="option-input-column">
                <ul id="option-link-body-classes" class="option-list">
                  <li class="option-list-item">
                    <input type="text" id="option-link-body-item-0" class="option-list-item-input" />
                  </li>
                </ul>
              </td>
            </tr>
            <tr>
              <td class="option-label-column align-top">
                <label for="option-link-arrow-classes">Link Arrow Classes</label><br>
                <span class="sub-title-button add-row disableDblClick" data-listid="#option-link-arrow-classes">Add Class Row</span>
              </td>
              <td class="option-input-column">
                <ul id="option-link-arrow-classes" class="option-list">
                  <li class="option-list-item">
                    <input type="text" id="option-link-arrow-item-0" class="option-list-item-input" />
                  </li>
                </ul>
              </td>
            </tr>
            <tr>
              <td><label for="option-forobj-not-supported">Foreign Obj Not Supported Msg</label></td>
              <td><input type="text" id="option-forobj-not-supported" /></td>
            </tr>
          </table>
          </div>
        </div>
      </div>
    </div>
  
    <!-- Container for inputting an HTML Template to apply to each node -->
    <div id="html-template-container" class="col-xs-12 col-sm-6 col-md-6 data-container">
      <div class="panel panel-default">
        <div class="panel-heading" data-toggle="collapse" href="#html-template-collapse">
          <h4 class="panel-title">
            <a>
              Node HTML Template
            </a>
          </h4>
        </div>
        <div id="html-template-collapse" class="panel-collapse collapse in">
          <div class="panel-body settings-panel-body">
            <p>Add the HTML template to be used for each node. Delete the default template copied below and replace with your own if supplying custom template. Example Usage: 
        <pre><code>function(node) { 
var htmlString = "";

/* Build Template String */ 
htmlString = htmlString + "&ltdiv&gt" + node.data.dataValue1 + "&lt/div&gt";
htmlString = htmlString + "&ltdiv&gt" + node.data.dataValue2 + "&lt/div&gt";

return htmlString; 
}</code></pre></p>
          <textarea class="textarea-input" id="node-html-template">function (d) {
    return '<div id="node-template">' + d.data  + '</div>';
  }
}</textarea>
          </div>
        </div>
      </div>
    </div>

    <!-- Container for inputting the JSON data representing the logical structure of the tree data -->
    <div id="data-container" class="col-xs-12 col-sm-6 col-md-6 data-container">
      <div class="panel panel-default">
        <div class="panel-heading" data-toggle="collapse" href="#json-tree-data-collapse">
          <h4 class="panel-title">
            <a>
              JSON Tree Data Input
            </a>
          </h4>
        </div>
        <div id="json-tree-data-collapse" class="panel-collapse collapse in">
          <div class="panel-body settings-panel-body">
            <p>Add stringified JSON data. Delete the default data copied below and replace with your own. Example Usage: 
        <pre><code>{
node: {
  data: {
    dataValue1: "testValue1",
    dataValue2: "testValue2"
  },
  node {

  }
}            
}</code></pre></p>
          <textarea class="textarea-input" id="node-data-input">node: {
  data: '1',
  node: [{
    data: '2',
    node: [{
      data: '5'
    }, {
      data: '6'
    }]
  }, {
    data: '3'
  }, {
    data: '4',
    node: [{
      data: '7',
      node: [{
        data: '10'
      }]
    }, {
      data: '8'
    }, {
      data: '9'
    }]
  }]
  }</textarea>
          </div>
        </div>
      </div>
    </div>

    <!-- Output sections with collapsable content -->
    <div class="col-xs-12 col-sm-12 col-md-12">
      <h3>Output
        <div class="sub-title-button"><a id="toggle-output-modules">Close / Open All Modules</a></div>
      </h3>
    </div>

    <div class="col-xs-12 col-sm-6 col-md-6">
      <div class="panel panel-default">
        <div class="panel-heading" data-toggle="collapse" href="#user-unformatted-collapse">
          <h4 class="panel-title">
            <a>
              Unformatted User Settings
            </a>
          </h4>
        </div>
        <div id="user-unformatted-collapse" class="panel-collapse collapse in">
          <div class="panel-body output-panel-body">
            <p>This unformatted json string can be copied and passed into your call to this plugin as user settings, in order to reproduce the manually configured tree.</p>
            <pre><code id="user-unformatted-settings" class="code-container"></code></pre>
          </div>
        </div>
      </div>
    </div>

    <div class="col-xs-12 col-sm-6 col-md-6">
      <div class="panel panel-default">
        <div class="panel-heading" data-toggle="collapse" href="#user-formatted-collapse">
          <h4 class="panel-title">
            <a>
              Formatted User Settings
            </a>
          </h4>
        </div>
        <div id="user-formatted-collapse" class="panel-collapse collapse in">
          <div class="panel-body output-panel-body">
            <p>This formatted json string contains the above user-specified settings, formatted for human readability.</p>
            <pre><code id="user-formatted-settings" class="code-container"></code></pre>
          </div>
        </div>
      </div>
    </div>

    <div class="col-xs-12 col-sm-6 col-md-6">
      <div class="panel panel-default">
        <div class="panel-heading" data-toggle="collapse" href="#default-formatted-collapse">
          <h4 class="panel-title">
            <a>
              Formatted Default Settings
            </a>
          </h4>
        </div>
        <div id="default-formatted-collapse" class="panel-collapse collapse in">
          <div class="panel-body output-panel-body">
            <p>This formatted json string contains the default tree settings, formatted for human readability.</p>
            <pre><code id="default-formatted-settings" class="code-container"></code></pre>
          </div>
        </div>
      </div>
    </div>

    <div class="col-xs-12 col-sm-6 col-md-6">
      <div class="panel panel-default">
        <div class="panel-heading" data-toggle="collapse" href="#compiled-formatted-collapse">
          <h4 class="panel-title">
            <a>
              Formatted Compiled Settings
            </a>
          </h4>
        </div>
        <div id="compiled-formatted-collapse" class="panel-collapse collapse in">
          <div class="panel-body output-panel-body">
            <p>This formatted json string contains a combination of the above default and user settings, with any user settings overriding the corresponding default settings except for classes, which are just added.</p>
            <pre><code id="compiled-formatted-settings" class="code-container"></code></pre>
          </div>
        </div>
      </div>
    </div>

  </div>
</body>
<div class="footer">
  <div class="container">
    <p class="footer-text"><a href="mailto:chris.setian@gmail.com">Christopher Setian</a> | <a href="https://github.com/cssetian">GitHub</a> | <a href="https://www.linkedin.com/pub/chris-setian/19/910/24a">LinkedIn</a> </p>
  </div>
</div>




<!-- Latest compiled and minified JavaScript -->
<script type="text/javascript" src="scripts/lib/jquery-1.11.1.js"></script>
<script type="text/javascript" src="scripts/lib/bootstrap-3.2.0.js"></script>
<script type="text/javascript" src="scripts/lib/d3-3.4.11.js" charset="utf-8"></script>
<script type="text/javascript" src="scripts/CSSTree.js"></script>
<script type="text/javascript" src="scripts/cssTreeDrawer.js"></script>


<!-- Main Application Initialization -->
<script type="text/javascript">

  $(document).ready(function(){
    var self = this;

    // Declare state variables
    self.userSettings = {};
    self.mergedSettings = {};
    self.outputPanelsClosed = false;
    self.settingsPanelsClosed = false;

    // Initialize expand / collapse modules to an expanded state
    $(function () { $('.output-panel-body').collapse({
      toggle: false
    })});
    $(function () { $('.settings-panel-body').collapse({
      toggle: false
    })});

    // Initialize default settings to be used for all layout calculations (basically same as class prototype)
    refreshPanelText('#default-formatted-settings', new CSSTree().defaultSettings, true);

    setupEvents();
  });

  // Define various onClick events for expand/collapse and adding rows
  var setupEvents = function() {
    // Expand / Collapse - all when button under section heading is selected
    $("#toggle-settings-modules").click(function(e) {
      if(self.settingsPanelsClosed) {
        $("#html-template-collapse").collapse('show');
        $("#json-tree-data-collapse").collapse('show');
        $("#tree-settings-collapse").collapse('show');
        self.settingsPanelsClosed = false;
      } else {
        $("#html-template-collapse").collapse('hide');
        $("#json-tree-data-collapse").collapse('hide');
        $("#tree-settings-collapse").collapse('hide');
        self.settingsPanelsClosed = true;
      }
    });

    // Expand / Collapse - all when button under section heading is selected
    $("#toggle-output-modules").click(function(e) {
      if(self.outputPanelsClosed) {
        $("#default-formatted-collapse").collapse('show');
        $("#compiled-formatted-collapse").collapse('show');
        $("#user-unformatted-collapse").collapse('show');
        $("#user-formatted-collapse").collapse('show');
        self.outputPanelsClosed = false;
      } else {
        $("#default-formatted-collapse").collapse('hide');
        $("#compiled-formatted-collapse").collapse('hide');
        $("#user-unformatted-collapse").collapse('hide');
        $("#user-formatted-collapse").collapse('hide');
        self.outputPanelsClosed = true;
      }
    });
    
    // Add a click event to each addRow button:
    //    - Adds a new element to the text input list
    //    - Each item in group included when compiling settings
    //    - When options are compiled, all empty boxes are ignored
    $(".add-row").click(function(e) {
      var ul = $(self.dataset.listid);

      var li = document.createElement("li");
      li.className = "option-list-item";

      var input = document.createElement("input");
      input.type = "text";
      input.className = "option-list-item-input";

      li.appendChild(input);
      ul.append(li);
    });
  };

  // We can use the extend method to merge userSettings with defaultSettings:
  // But with the added first parameter of TRUE to signify a DEEP COPY:
  var buildMergedSettings = function(userSettings) {
    self.mergedSettings = $.extend( true, new CSSTree().defaultSettings, userSettings );
    addClassArraysToMergedSettings(userSettings);
    return self.mergedSettings;
  };

  var addClassArraysToMergedSettings = function(userSettings) {
    if (userSettings.nodeBkndClasses != null) {
      self.mergedSettings.nodeBkndClasses = userSettings.nodeBkndClasses;
    }
    if (userSettings.nodeHTMLClasses != null) {
    self.mergedSettings.nodeHTMLClasses = userSettings.nodeHTMLClasses;
    }
    if (userSettings.linkClasses != null) {
      self.mergedSettings.linkClasses = userSettings.linkClasses;
    }
    if (userSettings.arrowClasses != null) {
      self.mergedSettings.arrowClasses = userSettings.arrowClasses;
    }
  }

  var buildUserSettings = function() {
    if($("input:radio[name='settings-source']:checked").val() === "user") {
      self.userSettings = buildUserSettings();
    }
    return self.userSettings;
  };

  // Define a function to refresh a given element with specific data
  var refreshPanelText = function(el, data, formatted) {
    $(el).html('');

    // If the text should be formatted, define size of indentation
    if(formatted) {
      $(el).html(JSON.stringify(data, undefined, 2));
    } else {
      $(el).html(JSON.stringify(data));
    }
  };

  var refreshSettingsPanels = function() {
    refreshPanelText('#user-unformatted-settings', self.userSettings, false);
    refreshPanelText('#user-formatted-settings', self.userSettings, true);
    refreshPanelText('#compiled-formatted-settings', self.mergedSettings, true);
  };

  // Builds settings and refreshes tree, redrawing on default root tree element
  // Reset content of the root tree element before redrawing
  var buildAndRefreshTree = function() {
    buildAndRefreshSettings();

    if ($("input:radio[name='data-source']:checked").val() === "user" && $("#node-data-input").val() !== "") {
      self.userSettings.nodeData = $("#node-data-input").val();
    }

    var newTreeContainerId = $.trim($("#option-tree-container-id").val()); 
    self.currentContainerId  = newTreeContainerId || "#tree-container";

    $(self.currentContainerId).text('');
    $(self.currentContainerId).drawCSSTree(self.userSettings);
  };


  // Parse all settings variables from form inputs to userSettings
  var buildUserSettings = function() {
    var self = this;

    self.userSettings = self.userSettings || {};

    // Define the tree container ID and padding
    if ($.trim($("#option-tree-container-id").val()) !== "") { 
      self.userSettings.treeContainerId = $.trim($("#option-tree-container-id").val()); 
    }
    if ($.trim($("#option-tree-container-padding").val()) !== "") { 
      self.userSettings.treeContainerPadding = $.trim($("#option-tree-container-padding").val()); 
    }

    // Define the json property name of the data nodes and child nodes
    if ($.trim($("#option-node-child-name").val()) !== "") { 
      self.userSettings.nodeChildName = $.trim($("#option-node-child-name").val()); 
    }
    if ($.trim($("#option-node-data-name").val()) !== "") { 
      self.userSettings.nodeDataName = $.trim($("#option-node-data-name").val()); 
    }

    // Translate the tree orientation from text to angle in degrees
    if ($("input:radio[name='tree-orientation']:checked").val()) { 
      self.userSettings.treeOrientation = $("input:radio[name='tree-orientation']:checked").val(); 
      switch(self.userSettings.treeOrientation) {
      case 'down':
        self.userSettings.treeOrientation = 0;
        break;
      case 'right':
        self.userSettings.treeOrientation = 90;
        break;
      case 'up':
        self.userSettings.treeOrientation = 180;
        break;
      case 'left':
        self.userSettings.treeOrientation = 270;
        break;
      }
    }

    // Tree link properties
    if ($("input:radio[name='link-orientation']:checked").val()) { 
      self.userSettings.linkOrientation = $("input:radio[name='link-orientation']:checked").val(); 
    }
    if ($("input:radio[name='option-link-strategy']:checked").val()) { 
      self.userSettings.linkType = $("input:radio[name='option-link-strategy']:checked").val(); 
    }
    
    // Tree spacing properties
    if ($.trim($("#option-node-width").val()) !== "") {
      self.userSettings.nodeWidth = parseInt($.trim($("#option-node-width").val()));
    }
    if ($.trim($("#option-node-height").val()) !== "" ) {
      self.userSettings.nodeHeight = parseInt($.trim($("#option-node-height").val()));
    }
    if ( $.trim($("#option-node-depth-spacing").val()) !== "" ) {
      self.userSettings.depthSpacing = parseInt($.trim($("#option-node-depth-spacing").val()));
    }
    if ( $.trim($("#option-node-width-spacing").val()) !== "" ) {
      self.userSettings.widthSpacing = parseInt($.trim($("#option-node-width-spacing").val()));
    }

    // HTML Template / foreign object inputs
    if ($.trim($("#option-forobj-not-supported").val()) !== "") { 
      self.userSettings.notSupportedMessage = $.trim($("#option-forobj-not-supported").val()); 
    }
    if ($.trim($("#node-html-template").val()) !== "") { 
      self.userSettings.nodeHTMLTemplate = eval($("#node-html-template").value); 
    }

    // Build class lists from groups of list entries 
    var classSettings = {};
    classSettings.tempNodeBkndClasses = buildArrayFromList("option-node-background-classes");
    classSettings.tempNodeHTMLClasses = buildArrayFromList("option-node-html-classes");
    classSettings.tempLinkClasses = buildArrayFromList("option-link-body-classes");
    classSettings.tempArrowClasses = buildArrayFromList("option-link-arrow-classes");

    addClassArraysToMergedSettings(classSettings);

    return self.userSettings;
  };

  // Builds compiled settings to use and display in formatted output.
  // First build default settings
  // Then merge with user input overridden settings, 
  // Display formatted/unformatted output in grid
  //      for default, user, and merged settings
  // Settings don't need to be merged w default settings because
  //      prototype object has defaults, but this allows for easy 
  //      display of merged settings on the page.
  var buildAndRefreshSettings = function() {
    var userSettings = buildUserSettings();
    buildMergedSettings(userSettings);
    refreshSettingsPanels();
  };

  // Builds an array of strings given the ID of an html list element
  var buildArrayFromList = function(listId) {
    var listItemsEl = document.getElementById(listId).getElementsByTagName('li');
    var outputList = [];
    for(var i = 0; i < listItemsEl.length; i++) {
      var listItemEl = listItemsEl[i];
      var itemInputEl = listItemEl.getElementsByTagName('input')[0];
      var listItemValue = $.trim(itemInputEl.value);
      if(listItemValue !== "") {
        outputList.push(listItemValue);
      }
    }
    if( outputList.length > 0) { 
      return outputList;
    } else {
      return null;
    }
  };

</script>
</html>
